# Отчёт по архитектуре и реализации приложения HseBank

## a. Общая идея решения

Реализовано консольное приложение для управления финансовыми данными, включающее работу с банковскими счетами, категориями и операциями.
Основные функции системы:

* **Ручное управление данными** `BankAccount`, `Category`, `Operation`
* **Импорт данных** из файлов в формате `.json` и `.csv`;
* **Экспорт данных** в файлы форматов `.json` и `.csv`;
* **Аналитика** по операциям (на основе стратегий анализа);
* **Интерактивное меню** для взаимодействия с пользователем.

Приложение построено в соответствии с принципами **DDD (Domain-Driven Design)** и разделено на слои:

* **Domain** — бизнес-логика, сущности, фабрики, исключения, интерфейсы.
* **Infrastructure** — работа с хранилищами, реализация импорта/экспорта, декораторы.
* **Application** — сервисы, orchestration-логика
* **ConsoleApp (UI)** — пользовательский интерфейс (меню, вывод аналитики).

### Дополнительные возможности:

* Гибкое добавление новых способов экспорта и испорта данных без изменения кода.
* Гибкое добавление новых стратегий анализа без изменения существующего кода.
* Обработка ошибок и обеспечение надёжности репозиториев через **декораторы**.

---

## b. Реализованные принципы SOLID и GRASP

| Принцип                       | Где реализован                                                                                        | Как реализован                                                                                             |
| ----------------------------- | ----------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| **S (Single Responsibility)** | `ImportService`, `ExportService`, `AnalyticsService`                                                  | Каждый сервис отвечает только за одну конкретную задачу: импорт, экспорт или анализ данных.                |
| **O (Open/Closed)**           | `FileImporterBase<T>`, `IFileExporter`, `IAnalyticsStrategy`                                          | Добавление новых форматов импорта, экспорта или стратегий анализа не требует изменения существующего кода. |
| **L (Liskov Substitution)**   | `IRepository<T>`, `EfRepository<T>`, `CachedRepositoryProxy<T>`, `SafeRepositoryDecorator<T>`         | Любая реализация репозитория может быть подставлена вместо интерфейса `IRepository<T>`.                    |
| **I (Interface Segregation)** | `IImportService`, `IExportService`, `IAnalyticsService`                                               | Интерфейсы разбиты по назначению, каждый клиент зависит только от необходимых методов.                     |
| **D (Dependency Inversion)**  | Все сервисы получают зависимости через **DI контейнер** (`Microsoft.Extensions.DependencyInjection`). | Зависимости задаются абстракциями, а не конкретными реализациями.                                          |

| GRASP                  | Где реализован                                                               | Как реализован                                                                            |
| ---------------------- | ---------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| **Information Expert** | `ImportService`, `ExportService`                                             | Сервисы знают, как работать с импортёрами/экспортёрами, т.к. обладают нужной информацией. |
| **Controller**         | `ImportMenuHandler`, `AnalyticsMenuHandler`                                  | Обрабатывают пользовательские команды, управляют запуском сервисов.                       |
| **Low Coupling**       | Через DI и интерфейсы (`IRepository`, `IFileExporter`, `IAnalyticsStrategy`) | Модули слабо связаны между собой, легко заменяемы.                                        |
| **High Cohesion**      | В слоях Domain, Infrastructure, Application                                  | Каждый слой выполняет строго определённую роль.                                           |

---

## c. Реализованные паттерны GoF

| Паттерн                               | Где реализован                                                                            | Назначение и важность                                                                                                                  |
| ------------------------------------- |-------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| **Factory Method / Abstract Factory** | `DomainFactory`                                                                           | Создание доменных объектов (`BankAccount`, `Category`, `Operation`) централизовано и валидируется.                                     |
| **Template Method**                   | `FileImporterBase<T>`                                                                     | Базовый шаблон импорта: чтение → парсинг → сохранение. Разные импортеры (JSON, CSV) переопределяют только `Parse()`.                   |
| **Decorator**                         | `CachedRepositoryProxy<T>`, `SafeRepositoryDecorator<T>`                                  | Расширяет поведение репозиториев (кэширование и безопасное выполнение) без изменения основной логики.                                  |
| **Facade**                            | `ImportService`, `ExportService`, `AnalyticsService`                                      | Скрывают сложность взаимодействия между множеством компонентов.                                                                        |
| **Visitor**                           | `IAnalyticsResultVisitor`, `ConsoleAnalyticsVisitor`, `CsvFileVisitor`, `JsonFileVisitor` | Позволяет обрабатывать разные типы результатов анализа и экспортировать разные типы без изменения логики сервиса.                      |
| **Strategy**                          | `IAnalyticsStrategy`, `ExpenseByCategoryStrategy`, `IncomeByAccountStrategy`              | Разделяет различные способы анализа данных, позволяя динамически подставлять нужный алгоритм.                                          |
| **Proxy**                             | `CachedRepositoryProxy<T>`                                                                | Управляет кэшированием данных, обращаясь к реальному репозиторию только при необходимости.                                             |
| **Adapter**                           | `VisitableRepositoryAdapter<T>`                                                           | Позволяет использовать разные типы репозиториев (`IRepository<BankAccount>` → `IRepository<IVisitable>`) при работе с `ExportService`. |

---

## Инструкции по запуску проекта

1. Склонировать репозиторий.
2. Открыть решение в Visual Studio / Rider / VS Code.
3. Сделать проект `ConsoleApp` стартовым.
4. Выполнить запуск:

    * В Visual Studio: `F5` или `Ctrl+F5`
    * Через терминал:

      ```bash
      dotnet restore
      dotnet build
      dotnet run --project src/ConsoleApp/ConsoleApp.csproj
      ```
---

### Работа с базой данных

В проекте используется Entity Framework Core и SQLite `finance.db`:

* при первом запуске она создаётся автоматически в каталоге `ConsoleApp`;
* для пересоздания базы выполните:

```bash
dotnet ef database update --project ./src/Infrastructure/Infrastructure.csproj
```

> Убедитесь, что в `appsettings.json` или в `Program.cs` строка подключения выглядит так:
>
> ```csharp
> options.UseSqlite("Data Source=finance.db");
> ```

---

## Тестирование (NUnit)

Проект использует NUnit для модульного тестирования.
Тесты расположены в папке:

**src/Tests/Services**

### Запуск тестов

```bash
  dotnet test --logger "console;verbosity=detailed"
```
---

## Вывод

Создана архитектура, которая:

* гибко расширяется за счёт DI, паттернов и модульной структуры;
* соответствует принципам **SOLID** и **GRASP**;
* использует классические паттерны GoF для снижения связанности и повышения читаемости;
* готова к дальнейшему развитию — добавлению новых источников импорта, экспорта, аналитических стратегий и интерфейсов вывода данных.

---